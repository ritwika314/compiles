using Lidar $\label{lidardef}$
    sensors:
       tscan[] ldata 
       float maxdist

using Motion $\label{moddef}$
    sensors:
        tPos[] trace, pos psn,
        bool reached
    actuators:
       pos target

allwrite:$\label{awvar}$
    int[][] gmap 
    
#$\mathit{omitting\ initialization}$

local:
   int dim
   int[][] lmap 
   posScan[] pscan
   pos[] obstacles
   int x,y
   bool newpoint $=$ True
   
NewPoint:$\label{newpt}$
  pre newpoint
  eff : lmap $=$ max(gmap, lmap)
        Motion.target $=$ pickMaxFree(lmap)
        newpoint $=$ False

LUpdate:$\label{lup}$
   pre !(newpoint $\mid\mid$ Motion.reached )
   eff : pscan $=$ tSync(Motion.tPos, Lidar.ldata)
         for i in pldata:
            setAll(getSquares(i.pos,i.scan,dim),0)
             obstacles $=$ getObs(i.pos, i.scan)
             for ob in obstacles:
                 x,y $=$ gridx(ob), gridy(ob)
                 lmap[x][y] $=$ 1
    
GUpdate: $\label{gup}$
  pre Motion.reached
  eff : atomic:
           max(lmap,gmap)
        newpoint $=$ True
      

