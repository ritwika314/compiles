using Lidar $\label{lidardef}$
    sensors:
       ScanStamped[] ldata

using Motion $\label{moddef}$
    sensors:
        Pos pos,
        PosStamped[] trace,
        bool reached
    actuators:
        Pos target

allwrite:$\label{awvar}$
    GridMap map

#$\mathit{omitting\ initialization}$

local:
   posScan pscan
   GridMap localMap
   bool newpoint $=$ True
   obs obstacles

NewPoint:$\label{newpt}$
  pre newpoint
  eff : LocalMap $=$ merge(localMap, map)
        obstacles = findObs(localMap)
        Motion.path $=$ find_path(pickFrontierPos(
                              localMap, Motion.pos), obstacles)
        if Motion.path is None:
           newpoint $=$ True
        else:
           newpoint $=$ False

LUpdate:$\label{lup}$
   pre not (newpoint || Motion.reached )
   eff : pscan $=$ tSync(Motion.trace, Lidar.ldata)
         for pos, scan in pscan:
             localmap $=$ merge(localMap,scanToMap(pos, scan))

GUpdate: $\label{gup}$
  pre Motion.reached
  eff: atomic:
           map $=$ merge(map, localMap)
        newpoint $=$ True
        update $=$ False