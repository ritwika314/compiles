using Lidar $\label{lidardef}$
    sensors:
       tscan[] ldata 
       float maxdist

using Motion $\label{moddef}$
    sensors:
        tPos[] trace, pos psn,
        bool reached
    actuators:
       pos target

allwrite:$\label{awvar}$
    int[][] globalMap 
    
#$\mathit{omitting\ initialization}$

local:
   int dim
   int[][] localMap 
   posScan[] pscan
   pos[] obstacles
   int x,y
   bool newpoint $=$ True
   
NewPoint:$\label{newpt}$
  pre newpoint
  eff : localMap $=$ max(globalMap, localMap)
        Motion.target $=$ pickMaxFree(localMap)
        newpoint $=$ False

LUpdate:$\label{lup}$
   pre not (newpoint || Motion.reached )
   eff : pscan $=$ tSync(Motion.tPos, Lidar.ldata)
         for i in pldata:
           setAll(getSquares(i.pos,i.scan,dim),0)
             obstacles $=$ getObs(i.pos, i.scan)
             for ob in obstacles:
                 x,y $=$ gridx(ob), gridy(ob)
                 localMap[x][y] $=$ 1
    
GUpdate: $\label{gup}$
  pre Motion.reached
  eff : atomic:
           max(localMap,globalMap)
        newpoint $=$ True