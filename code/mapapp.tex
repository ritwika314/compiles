using Lidar $\label{lidardef}$
    sensors:
       ScanStamped[] ldata

using Motion $\label{moddef}$
    sensors:
        Pos pos,
        PosStamped[] trace,
        bool reached
    actuators:
        Pos target

allwrite:$\label{awvar}$
    GridMap map

#$\mathit{omitting\ initialization}$

local:
   posScan pscan
   GridMap localMap
   bool newpoint $=$ True
   obs obstacles

NewPoint:$\label{newpt}$
  pre newpoint
  eff :
        obstacles = findObs(map)
        Motion.path $=$ findPath(pickFrontierPos(
                              map, Motion.pos), obstacles)
        if Motion.path is None:
           newpoint $=$ True
        else:
           newpoint $=$ False
        $\lmap $ = map

LUpdate:$\label{lup}$
   pre not (newpoint || Motion.reached )
   eff :
          pscan $=$ tSync(Motion.trace, Lidar.ldata)
         for pos, scan in pscan:
             $\lmap$ $=$ merge(\lmap,scanToMap(pos, scan))

GUpdate: $\label{gup}$
  pre Motion.reached
  eff: atomic:
           map $=$ merge(map, \lmap)
        newpoint $=$ True
        update $=$ False