using Lidar $\label{lidardef}$
    sensors:
       ScanStamped[] ldata

using Motion $\label{moddef}$
    sensors:
        Pos pos,
        PosStamped[] trace,
        bool reached
    actuators:
        Pos target

allwrite:$\label{awvar}$
    GridMap globalMap

#$\mathit{omitting\ initialization}$

local:
   posScan pscan
   GridMap localMap
   bool newpoint $=$ True
   obs obstacles

NewPoint:$\label{newpt}$
  pre newpoint
  eff : map $=$ map $\oplus$ globalMap
        obstacles = findObs(localMap)
        Motion.path $=$ find_path(pickFrontierPos(
                              localMap, Motion.pos), obstacles)
        if Motion.path is None:
           newpoint $=$ True
        else:
           newpoint $=$ False

LUpdate:$\label{lup}$
   pre not (newpoint || Motion.reached )
   eff : pscan $=$ tSync(Motion.trace, Lidar.ldata)
         for pos, scan in pscan:
             map $=$ map $\oplus$ scanToMap(pos, scan)

GUpdate: $\label{gup}$
  pre Motion.reached
  eff: atomic:
           globalMap $=$ globalMap $\oplus$ map
        newpoint $=$ True
        update $=$ False